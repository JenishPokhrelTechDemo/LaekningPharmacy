@page "/admin/products"
@page "/admin"
@inherits OwningComponentBase<IStoreRepository> <!-- Base component that injects the repository -->

<style>
    /* Main container styling for product table */
    .container {
        background: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px) brightness(1.3);
        -webkit-backdrop-filter: blur(20px) brightness(1.3);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        color: #000 !important;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Table layout and styling */
    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 0.75rem 1rem;
        border: 1px solid rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.6);
        color: #111;
        font-weight: 500;
    }

    .table th {
        background: rgba(255, 255, 255, 0.85);
        font-weight: bold;
        color: #000;
    }

    /* Header styling */
    .custom-header {
        text-align: center;
        font-size: 1.75rem;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
        color: #000;
    }

    /* Buttons with custom glow effects */
    .btn-warning, .btn-secondary {
        margin-right: 0.5rem;
        font-weight: bold;
        border-radius: 8px;
    }

	/* Cyan glow for Details button */
	.btn-info {
		background: rgba(0, 255, 255, 0.8);
		border-color: rgba(0, 255, 255, 0.8);
		box-shadow: 0 0 15px rgba(0, 255, 255, 1);
	}
	
	/* Custom dark button (used for Create link) */
	.custom-btn {
		background: rgba(0, 0, 0, 0.6);
		border: 1px solid rgba(0, 255, 255, 0.6);
		color: white;
		font-weight: bold;
		backdrop-filter: blur(4px);
		text-shadow: 2px 2px 5px rgba(255, 255, 255, 0.5);
		transition: all 0.3s ease;
	}
	
	.custom-btn:hover {
		background: rgba(0, 255, 255, 0.8);
		border-color: rgba(0, 255, 255, 0.8);
		box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
	}

	/* Magenta glow for Delete button */
	.btn-danger {
		background: rgba(255, 0, 255, 0.8);
		border-color: rgba(255, 0, 255, 0.8);
		box-shadow: 0 0 15px rgba(255, 0, 255, 1);
	}

	/* Amber glow for Edit button */
	.btn-warning {
		background: rgba(255, 191, 0, 0.8); 
		border-color: rgba(255, 191, 0, 0.8); 
		box-shadow: 0 0 15px rgba(255, 191, 0, 1); 
	}

</style>

<div class="container">
<table class="table table-sm table-striped table-bordered">
    <thead>
        <!-- Table header row -->
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price</th>
            <td /> <!-- Column for action buttons -->
        </tr>
    </thead>
    <tbody>
        @if (ProductData?.Count() > 0) {
            <!-- Loop through products -->
            @foreach (Product p in ProductData) {
                <tr>
                    <td>@p.ProductID</td> <!-- Product ID -->
                    <td>@p.Name</td>      <!-- Product Name -->
                    <td>@p.Category</td>  <!-- Product Category -->
                    <td>@p.Price.ToString("c")</td> <!-- Product Price formatted as currency -->
                    <td>
                        <!-- Action buttons -->
                        <NavLink class="btn btn-info btn-sm"
                         href="@GetDetailsUrl(p.ProductID ?? 0)">
                            Details
                        </NavLink>
                        <NavLink class="btn btn-warning btn-sm"
                         href="@GetEditUrl(p.ProductID ?? 0)">
                            Edit
                        </NavLink>
                        <button class="btn btn-danger btn-sm"
                                 @onclick="@(e => DeleteProduct(p))">
                            Delete
                        </button>
                    </td>
                </tr>
            }
        } else {
            <!-- If no products exist -->
            <tr>
                <td colspan="5" class="text-center">No Products</td>
            </tr>
        }
    </tbody>
</table>
</div>

<!-- Button to navigate to the Create Product page -->
<NavLink class="btn custom-btn" href="/admin/products/create">
    Create
</NavLink>

@code {

    // Repository for accessing product data
    public IStoreRepository Repository => Service;

    // Collection of products displayed in the table
    public IEnumerable<Product> ProductData { get; set; }
        = Enumerable.Empty<Product>();

    // Initialize component and load products
    protected async override Task OnInitializedAsync() {
        await UpdateData();
    }

    // Fetch latest product list from repository
    public async Task UpdateData() {
        ProductData = await Repository.Products.ToListAsync();
    }

    // Delete a product and refresh the table
    public async Task DeleteProduct(Product p) {
        Repository.DeleteProduct(p);
        await UpdateData();
    }

    // Build URL for product details page
    public string GetDetailsUrl(long id) => 
        $"/admin/products/details/{id}";

    // Build URL for product edit page
    public string GetEditUrl(long id) => 
        $"/admin/products/edit/{id}";
}
